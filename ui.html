<style>
  body {
    font-family: 'Inter', sans-serif;
    padding: 20px;
    color: #333;
    background-color: #f4f6f9;
    margin: 0;
    transition: background-color 0.3s ease;
  }
  
  .container {
    width: 100%;
    max-width: 640px;
    margin: 0 auto;
    background-color: white;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
  }
  
  h2 {
    margin-top: 0;
    font-size: 20px;
    font-weight: 600;
    display: flex;
    align-items: center;
    margin-bottom: 24px;
    color: #1E2A3B;
    letter-spacing: -0.01em;
  }
  
  h2 .emoji {
    margin-right: 10px;
    font-size: 24px;
    animation: pulse 2s infinite;
  }
  
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }
  
  label {
    display: block;
    margin-top: 16px;
    margin-bottom: 8px;
    font-weight: 500;
    font-size: 13px;
    color: #1E2A3B;
  }
  
  input, textarea, select {
    width: 100%;
    padding: 12px;
    border: 1px solid #E5E9F2;
    border-radius: 8px;
    font-size: 14px;
    box-sizing: border-box;
    background-color: #FCFCFD;
    transition: all 0.2s ease;
    box-shadow: 0 1px 3px rgba(0,0,0,0.02);
  }
  
  input:focus, textarea:focus, select:focus {
    outline: none;
    border-color: #18A0FB;
    box-shadow: 0 0 0 3px rgba(24,160,251,0.15);
    background-color: #ffffff;
  }
  
  textarea {
    min-height: 100px;
    resize: vertical;
  }
  
  button {
    margin-top: 24px;
    background-color: #18A0FB;
    color: white;
    border: none;
    padding: 12px 18px;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    width: 100%;
    font-size: 14px;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 5px rgba(24,160,251,0.3);
    position: relative;
    overflow: hidden;
  }
  
  button::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      rgba(255, 255, 255, 0.2),
      rgba(255, 255, 255, 0)
    );
    opacity: 0;
    transition: opacity 0.2s ease;
  }
  
  button:hover {
    background-color: #0D8EE4;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(24,160,251,0.4);
  }
  
  button:hover::after {
    opacity: 1;
  }
  
  button:active {
    transform: translateY(1px);
    box-shadow: 0 1px 3px rgba(24,160,251,0.3);
  }
  
  .button-icon {
    margin-right: 8px;
    animation: wobble 1.5s ease infinite;
  }
  
  @keyframes wobble {
    0%, 100% { transform: translateX(0); }
    15% { transform: translateX(-2px) rotate(-1deg); }
    30% { transform: translateX(1px) rotate(1deg); }
    45% { transform: translateX(-1px) rotate(0deg); }
    60% { transform: translateX(1px) rotate(0deg); }
    75% { transform: translateX(0px) rotate(0deg); }
  }
  
  .error {
    color: #E53E3E;
    margin-top: 10px;
    font-size: 13px;
    padding: 12px;
    background-color: #FFF5F5;
    border-radius: 8px;
    border-left: 3px solid #E53E3E;
    display: none;
    animation: fadeIn 0.3s ease;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .error.visible {
    display: flex;
    align-items: center;
  }
  
  .error.visible::before {
    content: "‚ö†Ô∏è";
    margin-right: 8px;
  }
  
  .template-selection {
    margin-bottom: 24px;
  }
  
  .radio-group {
    display: flex;
    gap: 10px;
    margin-top: 10px;
    flex-wrap: wrap;
  }
  
  .radio-option {
    display: flex;
    align-items: center;
    cursor: pointer;
    background-color: #F7FAFC;
    padding: 10px 14px;
    border-radius: 8px;
    transition: all 0.2s ease;
    border: 1px solid #E5E9F2;
    flex: 1;
    min-width: 120px;
  }
  
  .radio-option:hover {
    background-color: #EDF2F7;
    transform: translateY(-1px);
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }
  
  .radio-option.selected {
    background-color: #EBF8FF;
    border-color: #18A0FB;
    box-shadow: 0 2px 5px rgba(24,160,251,0.15);
  }
  
  .radio-option input {
    margin-right: 8px;
    width: auto;
  }
  
  .section {
    margin-bottom: 24px;
    padding-bottom: 24px;
    border-bottom: 1px solid #EDF2F7;
    transition: all 0.3s ease;
  }
  
  .section:hover {
    transform: translateY(-2px);
  }
  
  .section:last-child {
    border-bottom: none;
    padding-bottom: 0;
  }
  
  .section-header {
    display: flex;
    align-items: center;
    margin-bottom: 14px;
  }
  
  .section-icon {
    margin-right: 10px;
    font-size: 18px;
    animation: bounceIn 1s;
  }
  
  @keyframes bounceIn {
    0% { transform: scale(0.8); opacity: 0; }
    50% { transform: scale(1.1); opacity: 1; }
    100% { transform: scale(1); }
  }
  
  .help-text {
    font-size: 12px;
    color: #718096;
    margin-top: 6px;
    line-height: 1.4;
    padding-left: 2px;
  }
  
  .checkbox-option {
    display: flex;
    align-items: center;
    margin-top: 12px;
    background-color: #F7FAFC;
    padding: 12px 14px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    border: 1px solid #E5E9F2;
  }
  
  .checkbox-option:hover {
    background-color: #EDF2F7;
    transform: translateY(-1px);
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }
  
  .checkbox-option.checked {
    background-color: #EBF8FF;
    border-color: #18A0FB;
    box-shadow: 0 2px 5px rgba(24,160,251,0.15);
  }
  
  .checkbox-option input {
    margin-right: 8px;
    width: auto;
  }
  
  .cta-options {
    margin-top: 15px;
    padding: 15px;
    background-color: #F7FAFC;
    border-radius: 10px;
    border: 1px solid #E5E9F2;
  }
  
  .disabled-section {
    opacity: 0.6;
    pointer-events: none;
    filter: grayscale(30%);
  }
  
  .cta-option {
    display: flex;
    align-items: center;
    margin-bottom: 12px;
    padding: 10px 12px;
    background-color: white;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    border: 1px solid #E5E9F2;
  }
  
  .cta-option:hover {
    background-color: #F7FAFC;
    transform: translateY(-1px);
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }
  
  .cta-option.selected {
    background-color: #EBF8FF;
    border-color: #18A0FB;
    box-shadow: 0 2px 5px rgba(24,160,251,0.15);
  }
  
  .cta-option input {
    margin-right: 8px;
    width: auto;
  }
  
  .cta-option label {
    margin: 0;
    display: flex;
    align-items: center;
    cursor: pointer;
    width: 100%;
  }
  
  .cta-icon {
    margin-right: 10px;
    font-size: 18px;
  }
  
  .section-title {
    font-weight: 600;
    margin-top: 0;
    margin-bottom: 14px;
    font-size: 15px;
    display: flex;
    align-items: center;
    color: #1E2A3B;
  }
  
  .footer {
    text-align: center;
    margin-top: 24px;
    padding-top: 18px;
    border-top: 1px solid #EDF2F7;
    font-size: 12px;
    color: #718096;
    line-height: 1.5;
  }
  
  .secondary-button {
    background-color: #EDF2F7;
    color: #1E2A3B;
    margin-top: 12px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }
  
  .secondary-button:hover {
    background-color: #E2E8F0;
    box-shadow: 0 3px 6px rgba(0,0,0,0.08);
  }
  
  .success-message {
    background-color: #F0FFF4;
    color: #276749;
    padding: 12px;
    border-radius: 8px;
    margin-top: 12px;
    font-size: 13px;
    border-left: 3px solid #48BB78;
    display: flex;
    align-items: center;
    animation: slideIn 0.3s ease;
  }
  
  @keyframes slideIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .success-message::before {
    content: "‚úÖ";
    margin-right: 8px;
  }
  
  /* Tab-like navigation for input methods */
  .tabs {
    display: flex;
    margin-bottom: 24px;
    border-bottom: 1px solid #E5E9F2;
    padding-bottom: 0;
  }
  
  .tab {
    padding: 12px 16px;
    cursor: pointer;
    margin-right: 5px;
    border-radius: 8px 8px 0 0;
    background-color: #F7FAFC;
    transition: all 0.2s ease;
    font-weight: 500;
    font-size: 14px;
  }
  
  .tab:hover {
    background-color: #EDF2F7;
  }
  
  .tab.active {
    background-color: #EBF8FF;
    border-bottom: 2px solid #18A0FB;
    color: #18A0FB;
  }
  
  .tab-content {
    display: none;
    animation: fadeIn 0.3s ease;
  }
  
  .tab-content.active {
    display: block;
  }
  
  /* Resizing handle */
  .resize-handle {
    position: absolute;
    bottom: 15px;
    right: 25px;
    cursor: nwse-resize;
    font-size: 20px;
    color: #CBD5E0;
    transition: all 0.2s ease;
    height: 20px;
    width: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
  }
  
  .resize-handle:hover {
    color: #718096;
    background-color: #EDF2F7;
    transform: scale(1.1);
  }
  
  /* Dark mode support for future implementation */
  @media (prefers-color-scheme: dark) {
    body {
      /* Dark mode styles can be added later */
    }
  }
  
  /* Additional CSS for new interactive elements */
  .ripple-effect {
    position: absolute;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 50%;
    width: 100px;
    height: 100px;
    margin-top: -50px;
    margin-left: -50px;
    animation: ripple 0.5s linear;
    opacity: 0;
  }
  
  @keyframes ripple {
    0% { transform: scale(0); opacity: 0.5; }
    100% { transform: scale(2); opacity: 0; }
  }
  
  .loading-spinner {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 0.8s linear infinite;
    margin-right: 8px;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .error-shake {
    animation: shake 0.6s cubic-bezier(.36,.07,.19,.97) both;
    transform: translate3d(0, 0, 0);
    backface-visibility: hidden;
    border-color: #E53E3E !important;
  }
  
  @keyframes shake {
    10%, 90% { transform: translate3d(-1px, 0, 0); }
    20%, 80% { transform: translate3d(2px, 0, 0); }
    30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
    40%, 60% { transform: translate3d(4px, 0, 0); }
  }
  
  .field-updated {
    animation: highlight 0.8s ease;
    border-color: #38B2AC;
  }
  
  @keyframes highlight {
    0% { background-color: rgba(56, 178, 172, 0.1); }
    50% { background-color: rgba(56, 178, 172, 0.2); }
    100% { background-color: transparent; }
  }
  
  .success-ripple {
    display: inline-block;
    width: 8px;
    height: 8px;
    background-color: #48BB78;
    border-radius: 50%;
    margin-right: 5px;
    animation: pulsate 1.5s ease infinite;
  }
  
  @keyframes pulsate {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.5); opacity: 0.5; }
    100% { transform: scale(1); opacity: 1; }
  }
  
  .success-fade-out {
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.3s ease;
  }
  
  body.resizing {
    cursor: ns-resize;
  }
  
  .resize-handle.active {
    color: #18A0FB;
    background-color: #EBF8FF;
    transform: scale(1.2);
  }
  
  .section-focus {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }
  
  /* Option icons styling */
  .option-icon {
    display: inline-block;
    margin-right: 6px;
    animation: pop 0.3s ease;
  }
  
  @keyframes pop {
    0% { transform: scale(0.8); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }
  
  .footer-credits {
    margin-top: 5px;
    font-weight: 500;
    color: #A0AEC0;
  }
</style>

<div class="container">
  <h2><span class="emoji">üì∞</span> Dub News Generator</h2>
  
  <div class="tabs">
    <div class="tab active" data-tab="manual-tab">Manual Input</div>
    <div class="tab" data-tab="paste-tab">Paste from App</div>
  </div>
  
  <div id="manual-tab" class="tab-content active">
    <div class="section">
      <div class="section-header">
        <span class="section-icon">üìÑ</span>
        <label>Select Content Type:</label>
      </div>
      <div class="radio-group">
        <label class="radio-option selected" id="post-option">
          <input type="radio" name="content-type" value="post" checked> <span class="option-icon">üì±</span> Instagram Post
        </label>
        <label class="radio-option" id="story-option">
          <input type="radio" name="content-type" value="story"> <span class="option-icon">üìñ</span> Instagram Story
        </label>
        <label class="radio-option" id="market-recap-option">
          <input type="radio" name="content-type" value="market-recap"> <span class="option-icon">üìä</span> Market Recap
        </label>
      </div>
    </div>
    
    <div class="section">
      <div class="section-header">
        <span class="section-icon">üìÑ</span>
        <label>Select Template Type:</label>
      </div>
      <div class="radio-group">
        <label class="radio-option" id="breaking-option">
          <input type="radio" name="template-type" value="breaking" checked> <span class="option-icon">üî¥</span> Breaking News
        </label>
        <label class="radio-option" id="non-breaking-option">
          <input type="radio" name="template-type" value="non-breaking"> <span class="option-icon">üì£</span> Non-Breaking
        </label>
      </div>
    </div>
    
    <div class="section">
      <div class="section-header">
        <span class="section-icon">üìù</span>
        <label for="headline">Headline</label>
      </div>
      <textarea id="headline" placeholder="Enter news headline..." rows="3"></textarea>
      <div class="help-text">Will be formatted with ITC Cheltenham Std Book, 100pt, 102% line height</div>
    </div>
    
    <div class="section">
      <div class="section-header">
        <span class="section-icon">üìÑ</span>
        <label for="body">Body Text</label>
      </div>
      <textarea id="body" placeholder="Enter body text..."></textarea>
      <div class="help-text">Used for the News Body Template (SF Pro Display Semibold, 56pt)</div>
    </div>
    
    <div class="section">
      <div class="section-header">
        <span class="section-icon">üí¨</span>
        <label for="caption">Caption</label>
      </div>
      <textarea id="caption" placeholder="Enter caption for social media..."></textarea>
      <div class="help-text">Used for social media sharing of the content</div>
      <!-- Hidden field to store source information -->
      <input type="hidden" id="source-hidden" value="">
    </div>
    
    <div class="section">
      <div class="checkbox-option" id="cta-checkbox">
        <input type="checkbox" id="use-cta">
        <label for="use-cta"><span class="option-icon">üîó</span> Include CTA (Call to Action)</label>
      </div>
      
      <div id="cta-options" class="cta-options disabled-section">
        <div class="section-title"><span class="section-icon">üéØ</span> Select CTA Type:</div>
        <div class="cta-option" id="politician-option">
          <input type="radio" name="cta-type" id="cta-politician" value="politician" checked>
          <label for="cta-politician"><span class="cta-icon">üë®‚Äçüíº</span> Politician Template</label>
        </div>
        <div class="cta-option" id="crypto-option">
          <input type="radio" name="cta-type" id="cta-crypto" value="crypto">
          <label for="cta-crypto"><span class="cta-icon">ü™ô</span> Crypto Template</label>
        </div>
        <div class="cta-option" id="hedge-fund-option">
          <input type="radio" name="cta-type" id="cta-hedge-fund" value="hedge-fund">
          <label for="cta-hedge-fund"><span class="cta-icon">üìä</span> Hedge Fund Template</label>
        </div>
        <div class="cta-option" id="search-option">
          <input type="radio" name="cta-type" id="cta-search" value="search">
          <label for="cta-search"><span class="cta-icon">üîç</span> Search Template</label>
        </div>
        <div class="help-text">CTA will be added with the appropriate disclaimer template</div>
      </div>
    </div>
    
    <div class="checkbox-option" id="force-option">
      <input type="checkbox" id="force-create">
      <label for="force-create"><span class="option-icon">‚ö†Ô∏è</span> Force Create (bypass duplicate check)</label>
    </div>
  </div>
  
  <div id="paste-tab" class="tab-content">
    <div class="section">
      <div class="section-header">
        <span class="section-icon">üìã</span>
        <label for="paste-from-app">Paste from Python App</label>
      </div>
      <textarea id="paste-from-app" placeholder="Paste the DUB_NEWS_DATA output from the Python app here..." rows="8"></textarea>
      <div class="help-text">Format: DUB_NEWS_DATA_START... (output from the Python app)</div>
      <button id="parse-app-data" class="secondary-button">
        <span class="button-icon">üîÑ</span> Parse Data from App
      </button>
    </div>
  </div>
  
  <div id="error" class="error"></div>
  
  <button id="create-post"><span class="button-icon">‚ú®</span> Create News Post</button>
  
  <div class="footer">
    This plugin creates news posts with headlines, body text, CTAs, and appropriate disclaimers.
    <div class="footer-credits">Made with ‚ù§Ô∏è for your news workflow</div>
  </div>
</div>

<div class="resize-handle" title="Drag to resize">‚ü±</div>

<script>
  // Add loading state for buttons
  function setButtonLoading(button, isLoading) {
    if (isLoading) {
      const originalText = button.innerHTML;
      button.setAttribute('data-original-text', originalText);
      button.innerHTML = '<div class="loading-spinner"></div> Processing...';
      button.classList.add('loading');
    } else {
      const originalText = button.getAttribute('data-original-text');
      if (originalText) {
        button.innerHTML = originalText;
      }
      button.classList.remove('loading');
    }
  }

  // Add subtle entrance animations when the UI loads
  document.addEventListener('DOMContentLoaded', function() {
    // Animate sections entrance
    const sections = document.querySelectorAll('.section');
    sections.forEach((section, index) => {
      section.style.opacity = '0';
      section.style.transform = 'translateY(10px)';
      
      setTimeout(() => {
        section.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
        section.style.opacity = '1';
        section.style.transform = 'translateY(0)';
      }, 100 + (index * 50)); // Stagger the animations
    });
    
    // Add focus effects for inputs
    const inputs = document.querySelectorAll('input, textarea, select');
    inputs.forEach(input => {
      input.addEventListener('focus', function() {
        this.closest('.section')?.classList.add('section-focus');
      });
      
      input.addEventListener('blur', function() {
        this.closest('.section')?.classList.remove('section-focus');
      });
    });
  });

  // Create post functionality
  let isCreating = false;
  
  // Add visual feedback for selections
  document.querySelectorAll('.radio-option').forEach(option => {
    const input = option.querySelector('input');
    // Set initial state
    if (input.checked) {
      option.classList.add('selected');
    }
    
    // Add click event with improved visual feedback
    option.addEventListener('click', () => {
      // Add a subtle ripple effect
      const ripple = document.createElement('span');
      ripple.classList.add('ripple-effect');
      option.appendChild(ripple);
      
      // Remove ripple after animation completes
      setTimeout(() => {
        ripple.remove();
      }, 500);
      
      // Remove selected class from all options in group
      const name = input.name;
      document.querySelectorAll(`input[name="${name}"]`).forEach(radio => {
        radio.closest('.radio-option').classList.remove('selected');
      });
      
      // Add selected class to this option with a slight delay for better visual effect
      setTimeout(() => {
        option.classList.add('selected');
        input.checked = true;
        
        // Trigger change event for the input
        input.dispatchEvent(new Event('change'));
      }, 50);
    });
  });
  
  // Add visual feedback for CTA options
  document.querySelectorAll('.cta-option').forEach(option => {
    const input = option.querySelector('input');
    // Set initial state
    if (input.checked) {
      option.classList.add('selected');
    }
    
    // Add click event with improved visual feedback
    option.addEventListener('click', () => {
      // Add a subtle ripple effect
      const ripple = document.createElement('span');
      ripple.classList.add('ripple-effect');
      option.appendChild(ripple);
      
      // Remove ripple after animation completes
      setTimeout(() => {
        ripple.remove();
      }, 500);
      
      // Remove selected class from all options
      document.querySelectorAll('.cta-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      
      // Add selected class to this option with a slight delay
      setTimeout(() => {
        option.classList.add('selected');
        input.checked = true;
        
        // Trigger change event for the input
        input.dispatchEvent(new Event('change'));
      }, 50);
    });
  });
  
  // Add visual feedback for checkbox options
  document.querySelectorAll('.checkbox-option').forEach(option => {
    const input = option.querySelector('input');
    
    // Set initial state
    if (input.checked) {
      option.classList.add('checked');
    }
    
    // Add click event with improved visuals
    option.addEventListener('click', () => {
      // Add a subtle ripple effect
      const ripple = document.createElement('span');
      ripple.classList.add('ripple-effect');
      option.appendChild(ripple);
      
      // Remove ripple after animation completes
      setTimeout(() => {
        ripple.remove();
      }, 500);
      
      input.checked = !input.checked;
      
      if (input.checked) {
        option.classList.add('checked');
      } else {
        option.classList.remove('checked');
      }
      
      // Trigger change event for the input
      input.dispatchEvent(new Event('change'));
    });
  });
  
  // Show/hide CTA options based on checkbox with smooth animation
  document.getElementById('use-cta').addEventListener('change', function() {
    const ctaOptions = document.getElementById('cta-options');
    if (this.checked) {
      ctaOptions.style.maxHeight = '0';
      ctaOptions.classList.remove('disabled-section');
      setTimeout(() => {
        ctaOptions.style.maxHeight = ctaOptions.scrollHeight + 'px';
      }, 10);
    } else {
      ctaOptions.style.maxHeight = ctaOptions.scrollHeight + 'px';
      setTimeout(() => {
        ctaOptions.style.maxHeight = '0';
        setTimeout(() => {
          ctaOptions.classList.add('disabled-section');
        }, 300);
      }, 10);
    }
    updateButtonText();
  });
  
  // Update button text based on selections
  function updateButtonText() {
    const contentType = document.querySelector('input[name="content-type"]:checked').value;
    const templateType = document.querySelector('input[name="template-type"]:checked').value;
    const useCta = document.getElementById('use-cta').checked;
    let buttonText = `‚ú® Create ${contentType === 'story' ? 'üìñ Story' : contentType === 'market-recap' ? 'üìä Market Recap' : 'üì± Post'} - ${templateType === 'breaking' ? 'üî¥ Breaking' : 'üì£ Non-Breaking'}`;
    
    if (useCta) {
      const ctaType = document.querySelector('input[name="cta-type"]:checked').value;
      let ctaEmoji = 'üîó';
      switch(ctaType) {
        case 'politician': ctaEmoji = 'üë®‚Äçüíº'; break;
        case 'crypto': ctaEmoji = 'ü™ô'; break;
        case 'hedge-fund': ctaEmoji = 'üìä'; break;
        case 'search': ctaEmoji = 'üîç'; break;
      }
      buttonText += ` with ${ctaEmoji} ${ctaType.charAt(0).toUpperCase() + ctaType.slice(1)} CTA`;
    }
    
    const createButton = document.getElementById('create-post');
    // Save current button text
    const currentText = createButton.innerHTML;
    // Set new text with animation
    createButton.style.opacity = '0.5';
    setTimeout(() => {
      createButton.innerHTML = `<span class="button-icon">‚ú®</span> ${buttonText}`;
      createButton.style.opacity = '1';
    }, 150);
  }
  
  // Add event listeners for all form controls to update button text
  document.querySelectorAll('input[name="template-type"], input[name="content-type"], input[name="cta-type"], #use-cta')
    .forEach(input => input.addEventListener('change', updateButtonText));
  
  // Call once to set initial text
  updateButtonText();
  
  document.getElementById('create-post').onclick = () => {
    if (isCreating) return; // Prevent multiple rapid clicks
    
    isCreating = true;
    
    // Visual feedback when creating
    const createButton = document.getElementById('create-post');
    setButtonLoading(createButton, true);
    
    setTimeout(() => { 
      isCreating = false;
      setButtonLoading(createButton, false);
    }, 2000); // Reset after 2 seconds
    
    const headline = document.getElementById('headline').value;
    const body = document.getElementById('body').value;
    const caption = document.getElementById('caption').value;
    const contentType = document.querySelector('input[name="content-type"]:checked').value;
    const templateType = document.querySelector('input[name="template-type"]:checked').value;
    const useCta = document.getElementById('use-cta').checked;
    const ctaType = useCta ? document.querySelector('input[name="cta-type"]:checked').value : '';
    const forceCreate = document.getElementById('force-create').checked;
    // Get source from hidden field if it exists, otherwise empty string
    const source = document.getElementById('source-hidden') ? document.getElementById('source-hidden').value : '';
    
    if (!headline) {
      const errorEl = document.getElementById('error');
      errorEl.textContent = '‚ö†Ô∏è Please enter a headline.';
      errorEl.classList.add('visible');
      isCreating = false;
      setButtonLoading(createButton, false);
      
      // Shake animation for the headline field to draw attention
      const headlineField = document.getElementById('headline');
      headlineField.classList.add('error-shake');
      setTimeout(() => {
        headlineField.classList.remove('error-shake');
      }, 600);
      
      return;
    }
    
    document.getElementById('error').classList.remove('visible');
    
    parent.postMessage({
      pluginMessage: {
        type: 'create-post',
        headline,
        body,
        caption,
        contentType,
        templateType,
        useCta,
        ctaType,
        instagram: "",
        force: forceCreate,
        source: source
      }
    }, '*');
  };
  
  // Handle messages from the plugin code
  window.onmessage = (event) => {
    const message = event.data.pluginMessage;
    if (!message) return;
    
    if (message.type === 'confirm-duplicate') {
      if (confirm(message.message)) {
        // User confirmed, create the post anyway
        const headline = document.getElementById('headline').value;
        const body = document.getElementById('body').value;
        const caption = document.getElementById('caption').value;
        const contentType = document.querySelector('input[name="content-type"]:checked').value;
        const templateType = document.querySelector('input[name="template-type"]:checked').value;
        const useCta = document.getElementById('use-cta').checked;
        const ctaType = useCta ? document.querySelector('input[name="cta-type"]:checked').value : '';
        const source = document.getElementById('source-hidden') ? document.getElementById('source-hidden').value : '';
        
        // Add a flag to force creation even if duplicate
        parent.postMessage({
          pluginMessage: {
            type: 'create-post',
            headline,
            body,
            caption,
            contentType,
            templateType,
            useCta,
            ctaType,
            instagram: "",
            force: true,
            source: source
          }
        }, '*');
      }
      isCreating = false;
      setButtonLoading(document.getElementById('create-post'), false);
    }
  };
  
  // Add keyboard shortcut
  document.addEventListener('keydown', (e) => {
    // Ctrl+Enter or Cmd+Enter to trigger generate
    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
      document.getElementById('create-post').click();
    }
  });
  
  document.getElementById('parse-app-data').onclick = () => {
    // Visual feedback when parsing
    const parseButton = document.getElementById('parse-app-data');
    setButtonLoading(parseButton, true);
    
    const pastedData = document.getElementById('paste-from-app').value.trim();
    
    if (!pastedData || !pastedData.includes('DUB_NEWS_DATA_START')) {
      const errorEl = document.getElementById('error');
      errorEl.textContent = '‚ö†Ô∏è Invalid data format. Please paste the complete output from the Python app.';
      errorEl.classList.add('visible');
      setButtonLoading(parseButton, false);
      return;
    }
    
    try {
      // Extract the data between the start and end markers
      const startMarker = 'DUB_NEWS_DATA_START';
      const endMarker = 'DUB_NEWS_DATA_END';
      
      const startIndex = pastedData.indexOf(startMarker) + startMarker.length;
      const endIndex = pastedData.indexOf(endMarker);
      
      if (startIndex === -1 || endIndex === -1) {
        throw new Error('Invalid data format - missing start or end markers');
      }
      
      const dataSection = pastedData.substring(startIndex, endIndex).trim();
      
      // Create an object to hold the parsed data
      const parsedData = {};
      
      // Define the fields we're looking for
      const fields = [
        { key: 'CONTENT_TYPE', nextKey: 'TEMPLATE_TYPE' },
        { key: 'TEMPLATE_TYPE', nextKey: 'HEADLINE' },
        { key: 'HEADLINE', nextKey: 'BODY' },
        { key: 'BODY', nextKey: 'INSTAGRAM' },
        { key: 'INSTAGRAM', nextKey: 'SOURCE' },
        { key: 'SOURCE', nextKey: 'USE_CTA' },
        { key: 'USE_CTA', nextKey: 'CTA_TYPE' },
        { key: 'CTA_TYPE', nextKey: null }
      ];
      
      // Process each field
      fields.forEach((field, i) => {
        const keyPattern = new RegExp(`${field.key}:\\s*`);
        const keyMatch = dataSection.match(keyPattern);
        
        if (keyMatch) {
          const keyStart = keyMatch.index + keyMatch[0].length;
          
          // Find the next key, or use the end of the data section if this is the last field
          let valueEnd;
          if (field.nextKey) {
            const nextKeyPattern = new RegExp(`${field.nextKey}:\\s*`);
            const nextKeyMatch = dataSection.match(nextKeyPattern);
            valueEnd = nextKeyMatch ? nextKeyMatch.index : dataSection.length;
          } else {
            valueEnd = dataSection.length;
          }
          
          // Extract the value
          const value = dataSection.substring(keyStart, valueEnd).trim();
          parsedData[field.key] = value;
        }
      });
      
      // Fill the form with the parsed data
      
      // Content type - Handle both formats
      let contentType = parsedData['CONTENT_TYPE'] || 'post';
      // Convert market_recap (underscore) to market-recap (hyphen) for UI
      if (contentType === 'market_recap') {
        contentType = 'market-recap';
      }
      
      document.querySelectorAll('input[name="content-type"]').forEach(input => {
        input.checked = input.value === contentType;
        if (input.checked) {
          input.closest('.radio-option').classList.add('selected');
        } else {
          input.closest('.radio-option').classList.remove('selected');
        }
      });
      
      // Handle UI visibility based on content type
      let captionSection = document.getElementById('caption').closest('.section');
      let ctaSection = document.getElementById('cta-checkbox').closest('.section');
      let templateTypeSection = document.querySelector('input[name="template-type"]').closest('.section');
      
      if (contentType === 'story') {
        captionSection.style.display = 'none';
        ctaSection.style.display = 'none';
        templateTypeSection.style.display = 'block';
        // Ensure CTA is unchecked for stories
        document.getElementById('use-cta').checked = false;
        document.getElementById('cta-options').classList.add('disabled-section');
      } else if (contentType === 'market-recap') {
        captionSection.style.display = 'block';
        ctaSection.style.display = 'block';
        templateTypeSection.style.display = 'none';
      } else {
        captionSection.style.display = 'block';
        ctaSection.style.display = 'block';
        templateTypeSection.style.display = 'block';
      }
      
      // Template type (only if not market-recap)
      if (contentType !== 'market-recap') {
        const templateType = parsedData['TEMPLATE_TYPE'] || 'non-breaking';
        document.querySelectorAll('input[name="template-type"]').forEach(input => {
          input.checked = input.value === templateType;
          if (input.checked) {
            input.closest('.radio-option').classList.add('selected');
          } else {
            input.closest('.radio-option').classList.remove('selected');
          }
        });
      }
      
      // Headline - with animation
      const headlineField = document.getElementById('headline');
      headlineField.value = parsedData['HEADLINE'] || '';
      headlineField.classList.add('field-updated');
      setTimeout(() => {
        headlineField.classList.remove('field-updated');
      }, 800);
      
      // Body - with animation
      const bodyField = document.getElementById('body');
      bodyField.value = parsedData['BODY'] || '';
      bodyField.classList.add('field-updated');
      setTimeout(() => {
        bodyField.classList.remove('field-updated');
      }, 800);
      
      // Caption (Instagram) - with animation
      const captionInput = document.getElementById('caption');
      captionInput.value = parsedData['INSTAGRAM'] || '';
      captionInput.classList.add('field-updated');
      setTimeout(() => {
        captionInput.classList.remove('field-updated');
      }, 800);
      
      // Source (store in hidden field)
      if (parsedData['SOURCE']) {
        document.getElementById('source-hidden').value = parsedData['SOURCE'];
        console.log("Source identified:", parsedData['SOURCE']);
      }
      
      // CTA (only if not story)
      const useCta = (parsedData['USE_CTA'] || '').toLowerCase() === 'true';
      document.getElementById('use-cta').checked = useCta && contentType !== 'story';
      
      // Update UI to show/hide CTA options
      const ctaOptions = document.getElementById('cta-options');
      if (useCta && contentType !== 'story') {
        ctaOptions.classList.remove('disabled-section');
        
        // Set CTA type
        const ctaType = (parsedData['CTA_TYPE'] || '').toLowerCase();
        document.querySelectorAll('input[name="cta-type"]').forEach(input => {
          input.checked = input.value.toLowerCase() === ctaType;
          if (input.checked) {
            input.closest('.cta-option').classList.add('selected');
          } else {
            input.closest('.cta-option').classList.remove('selected');
          }
        });
      } else {
        ctaOptions.classList.add('disabled-section');
      }
      
      // Update any visual states
      document.querySelectorAll('.checkbox-option').forEach(option => {
        const input = option.querySelector('input');
        if (input.checked) {
          option.classList.add('checked');
        } else {
          option.classList.remove('checked');
        }
      });
      
      // Update the button text
      updateButtonText();
      
      // Hide any error message
      document.getElementById('error').classList.remove('visible');
      
      // Add success message with animation
      const successMessageDiv = document.createElement('div');
      successMessageDiv.className = 'success-message';
      successMessageDiv.textContent = 'Successfully parsed data! Click "Create News Post" to generate.';
      
      // Add ripple animation in the background
      successMessageDiv.innerHTML = '<span class="success-ripple"></span> Successfully parsed data! Click "Create News Post" to generate.';
      
      // Insert after the parse button
      const parseButton = document.getElementById('parse-app-data');
      parseButton.parentNode.insertBefore(successMessageDiv, parseButton.nextSibling);
      
      // Reset the button loading state
      setButtonLoading(parseButton, false);
      
      // Remove success message after 5 seconds
      setTimeout(() => {
        successMessageDiv.classList.add('success-fade-out');
        setTimeout(() => {
          successMessageDiv.remove();
        }, 300);
      }, 5000);
      
    } catch (error) {
      console.error('Error parsing data:', error);
      const errorEl = document.getElementById('error');
      errorEl.textContent = `‚ö†Ô∏è Error parsing data: ${error.message}`;
      errorEl.classList.add('visible');
      setButtonLoading(parseButton, false);
    }
  };
  
  // Add this to handle tab switching with animation - simplified version
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', function() {
      // Skip if this tab is already active
      if (this.classList.contains('active')) return;
      
      const tabId = this.getAttribute('data-tab');
      const targetContent = document.getElementById(tabId);
      
      // Handle tab switching
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      this.classList.add('active');
      
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      targetContent.classList.add('active');
      
      // Simple fade-in animation
      targetContent.style.opacity = '0';
      setTimeout(() => {
        targetContent.style.opacity = '1';
      }, 50);
    });
  });

  // Add resize functionality with support for wider UI
  const resizeHandle = document.querySelector('.resize-handle');
  
  let startHeight, startY;
  
  resizeHandle.addEventListener('mousedown', (e) => {
    startY = e.clientY;
    startHeight = window.innerHeight;
    
    document.addEventListener('mousemove', resize);
    document.addEventListener('mouseup', stopResize);
    
    // Add visual feedback during resize
    document.body.classList.add('resizing');
    resizeHandle.classList.add('active');
    
    e.preventDefault();
  });
  
  function resize(e) {
    const deltaY = e.clientY - startY;
    const newHeight = startHeight + deltaY;
    
    // Send message to resize with wider width
    parent.postMessage({
      pluginMessage: {
        type: 'resize',
        width: 680, // Increased width even more
        height: Math.max(400, newHeight)
      }
    }, '*');
  }
  
  function stopResize() {
    document.removeEventListener('mousemove', resize);
    document.removeEventListener('mouseup', stopResize);
    
    // Remove visual feedback
    document.body.classList.remove('resizing');
    resizeHandle.classList.remove('active');
  }
</script> 